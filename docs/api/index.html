<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>ForUsAll File Upload Bot — API Reference</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="/docs/images/icon.png" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="wrap header-row">
      <h1 class="title">ForUsAll File Upload Bot — API Reference</h1>

      <!-- Top bar: Back to Docs + Language -->
      <nav class="topnav">
        <a id="back-link" class="toplink" href="/docs">Go back to Docs</a>
        <span class="spacer"></span>
        <label for="lang-select" class="sr-only">Language</label>
        <div class="lang-switch">
          <select id="lang-select" aria-label="Language">
            <option value="en" selected>EN</option>
            <option value="es">ES</option>
          </select>
        </div>
      </nav>
    </div>

    <div class="wrap meta-row">
      <div class="meta">
        <a class="muted small" href="/docs/openapi.yaml">openapi.yaml</a>
        <span class="badge">v1.0.0</span>
        <span class="badge alt">OAS 3.0</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <p class="lead">
      Minimal REST endpoints that back the Playwright automation which logs into the portal,
      fills the upload form, and submits a document.
    </p>

    <h2 id="default" class="tag">default</h2>

    <!-- GET /health -->
    <details class="op get">
      <summary>
        <span class="method get">GET</span>
        <span class="path">/health</span>
        <span class="sum">Health Check</span>
      </summary>
      <div class="op-body">
        <p class="muted">Enhanced health check with system resources.</p>

        <h4>Parameters</h4>
        <div class="muted">No parameters.</div>

        <h4>Responses</h4>
        <div class="resp">
          <div class="code">200 <span class="muted">Successful Response</span></div>
          <pre><code class="json">{
  "ok": true
}</code></pre>
        </div>
      </div>
    </details>

    <!-- POST /run-binary -->
    <details class="op post">
      <summary>
        <span class="method post">POST</span>
        <span class="path">/run-binary</span>
        <span class="sum">Upload file &amp; run automation</span>
      </summary>
      <div class="op-body">
        <p class="muted">
          Accepts a raw binary body (PDF/Octet-Stream) with headers carrying metadata.
          The server logs in, validates OTP, fills the form, and submits it.
        </p>

        <h4>Parameters (Headers)</h4>
        <table class="tbl">
          <thead><tr><th>Name</th><th>In</th><th>Type</th><th>Req</th><th>Description</th></tr></thead>
          <tbody>
            <tr><td><code>x-auth-token</code></td><td>header</td><td>string</td><td>yes</td><td>Must match server env <code>SHARED_TOKEN</code>.</td></tr>
            <tr><td><code>x-filename</code></td><td>header</td><td>string</td><td>yes</td><td>Original filename (used for temp write).</td></tr>
            <tr><td><code>x-meta</code></td><td>header</td><td>string (JSON)</td><td>yes</td><td>See schema.</td></tr>
            <tr><td><code>Content-Type</code></td><td>header</td><td>enum</td><td>yes</td><td><code>application/octet-stream</code> or <code>application/pdf</code>.</td></tr>
          </tbody>
        </table>

        <h4>Request: <code>x-meta</code> (simplified)</h4>
        <pre><code class="json">{
  "planId": 580,
  "formData": {
    "section": "CONTRACTS & AGREEMENTS",
    "caption": "Recordkeeper Agreement",
    "captionOtherText": "(required only if caption = 'Other')",
    "status": "Audit Ready",
    "effectiveDate": "2025-05-02"
  },
  "options": {
    "confirmDelayMs": 5000,
    "fastExit": false,
    "snifferWindowMs": 7000
  }
}</code></pre>

        <h4>Responses</h4>

        <div class="resp">
          <div class="code">200 <span class="muted">Success</span></div>
          <pre><code class="json">{
  "ok": true,
  "message": "File uploaded",
  "newUrl": "https://.../manage_fv_document?...",
  "postSubmitResult": "same-url",
  "defaultsVerified": true,
  "warnings": [],
  "evidence": {
    "loginShotPath": "/tmp/evidence/2025-08-15T03-01-33.460Z_login.png",
    "uploadShotPath": "/tmp/evidence/2025-08-15T03-01-46.623Z_after_submit.png"
  }
}</code></pre>
        </div>

        <div class="resp">
          <div class="code">400 <span class="muted">Bad Request</span></div>
          <pre><code class="json">{
  "ok": false,
  "errorType": "validation",
  "error": "Missing or empty fields in x-meta",
  "missing": ["formData.status"]
}</code></pre>
        </div>

        <div class="resp">
          <div class="code">401 <span class="muted">Unauthorized</span></div>
          <pre><code class="json">{
  "ok": false,
  "error": "unauthorized"
}</code></pre>
        </div>

        <div class="resp">
          <div class="code">422 <span class="muted">Unprocessable Entity</span></div>
          <pre><code class="json">{
  "ok": false,
  "errorType": "validation",
  "error": "Status 'Document Missing' is not allowed when a file is attached",
  "hint": "Use 'Audit Ready' or another status allowed by the portal"
}</code></pre>
        </div>

        <div class="resp">
          <div class="code">500 <span class="muted">Internal Server Error</span></div>
          <pre><code class="json">{
  "ok": false,
  "error": "Unexpected runtime error"
}</code></pre>
        </div>
      </div>
    </details>

    <h2 id="schemas" class="tag">Schemas</h2>

    <details class="schema">
      <summary><strong>x-meta</strong></summary>
      <pre><code class="json">{
  "planId": number,
  "formData": {
    "section": string,
    "caption": string,
    "captionOtherText"?: string,
    "status": string,
    "effectiveDate": "YYYY-MM-DD"
  },
  "options"?: {
    "returnEvidenceBase64"?: boolean,
    "saveEvidenceToTmp"?: boolean,
    "confirmDelayMs"?: number,
    "fastExit"?: boolean,
    "snifferWindowMs"?: number,
    "suppressSameUrlWarning"?: boolean,
    "evidenceOnSuccess"?: boolean,
    "skipPrevalidation"?: boolean
  }
}</code></pre>
    </details>

    <details class="schema">
      <summary><strong>Success</strong></summary>
      <pre><code class="json">{
  "ok": true,
  "message": "File uploaded",
  "newUrl": "string",
  "postSubmitResult": "url-change|http-2xx|success-selector|form-reset|same-url",
  "defaultsVerified": true,
  "warnings": [ "string" ],
  "evidence": {
    "loginShotPath": "string",
    "uploadShotPath": "string",
    "loginShotBase64"?: "string",
    "uploadShotBase64"?: "string"
  }
}</code></pre>
    </details>

    <details class="schema">
      <summary><strong>Error</strong></summary>
      <pre><code class="json">{
  "ok": false,
  "error": "string",
  "errorType"?: "parse|validation|runtime",
  "warnings"?: [ "string" ]
}</code></pre>
    </details>

    <footer class="foot muted small">
      Last updated 2025-08-15 • Static docs (no “Try it out”)
    </footer>
  </main>

  <script>
    (function () {
      var isES = location.pathname.replace(/\/+$/,'').endsWith('/docs/api/es');
      var sel = document.getElementById('lang-select');
      if (sel) {
        sel.value = isES ? 'es' : 'en';
        sel.addEventListener('change', function (e) {
          var v = e.target.value;
          location.href = v === 'es' ? '/docs/api/es' : '/docs/api';
        });
      }
      var back = document.getElementById('back-link');
      if (back) back.href = isES ? '/docs/es' : '/docs';
    })();
  </script>
</body>
</html>
